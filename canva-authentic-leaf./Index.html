<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Savo Studio - Mathematics in Nature</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f4c3a 0%, #2d5a27 25%, #1a472a 50%, #0d3d2f 75%, #0a2f23 100%);
            background-size: 400% 400%;
            animation: naturalGradient 20s ease infinite;
            min-height: 100vh;
            color: #e8f5e8;
            overflow-x: hidden;
        }
        
        @keyframes naturalGradient {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 50% 100%; }
            75% { background-position: 50% 0%; }
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><defs><pattern id="fibonacci" width="100" height="100" patternUnits="userSpaceOnUse"><path d="M 0 0 Q 25 25 50 0 Q 75 25 100 0 Q 75 75 50 100 Q 25 75 0 100 Q 25 25 0 0" fill="none" stroke="%23ffffff" stroke-width="0.3" opacity="0.1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23fibonacci)"/></svg>');
            pointer-events: none;
            z-index: 1;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px 30px;
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.05), transparent);
            animation: shimmer 4s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .header h1 {
            font-size: clamp(2.5rem, 7vw, 5rem);
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #4ade80, #22d3ee, #a78bfa, #fb7185, #fbbf24);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textFlow 6s ease infinite;
            position: relative;
            z-index: 1;
        }
        
        @keyframes textFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .subtitle {
            font-size: clamp(1rem, 3vw, 1.4rem);
            opacity: 0.9;
            font-weight: 500;
            position: relative;
            z-index: 1;
            margin-bottom: 10px;
        }
        
        .tagline {
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            opacity: 0.7;
            font-style: italic;
            position: relative;
            z-index: 1;
        }
        
        .studio-layout {
            display: grid;
            grid-template-columns: 300px 1fr 280px;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .canvas-area {
            background: rgba(255,255,255,0.12);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            min-height: 600px;
            position: relative;
        }
        
        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .panel {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border-color: rgba(255,255,255,0.25);
        }
        
        .panel h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4ade80;
        }
        
        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .pattern-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px 10px;
            color: #e8f5e8;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-family: 'Inter', sans-serif;
        }
        
        .pattern-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
            border-color: rgba(74, 222, 128, 0.5);
        }
        
        .pattern-btn.active {
            background: rgba(74, 222, 128, 0.2);
            border-color: rgba(74, 222, 128, 0.6);
            color: #4ade80;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: #a7f3d0;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.2);
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 5px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4ade80;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(74, 222, 128, 0.4);
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4ade80;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(74, 222, 128, 0.4);
        }
        
        .value-display {
            font-size: 0.8rem;
            color: #4ade80;
            font-weight: 600;
        }
        
        .color-picker {
            width: 100%;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: none;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #4ade80, #22d3ee);
            color: white;
            box-shadow: 0 8px 25px rgba(74, 222, 128, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e8f5e8;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
        }
        
        .canvas {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            cursor: crosshair;
        }
        
        .info-panel {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .info-title {
            font-size: 1rem;
            font-weight: 600;
            color: #4ade80;
            margin-bottom: 8px;
        }
        
        .info-text {
            font-size: 0.85rem;
            line-height: 1.4;
            opacity: 0.8;
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .gallery-item {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.15);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            text-align: center;
            padding: 5px;
        }
        
        .gallery-item:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }
        
        /* Mobile Responsive */
        @media (max-width: 1200px) {
            .studio-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .sidebar {
                order: 2;
            }
            
            .controls-panel {
                order: 3;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                padding: 25px 20px;
                margin-bottom: 25px;
            }
            
            .panel {
                padding: 15px;
            }
            
            .pattern-grid {
                grid-template-columns: 1fr;
            }
            
            .canvas {
                height: 400px;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(74, 222, 128, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(74, 222, 128, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌿 Savo Studio</h1>
            <p class="subtitle">Mathematics in Nature Creation Tool</p>
            <p class="tagline">"Where Sacred Geometry Meets Natural Beauty"</p>
        </div>
        
        <div class="studio-layout">
            <div class="sidebar">
                <div class="panel">
                    <h3>🌸 Natural Patterns</h3>
                    <div class="pattern-grid">
                        <button class="pattern-btn active" onclick="selectPattern('fibonacci')">🌻 Fibonacci Spiral</button>
                        <button class="pattern-btn" onclick="selectPattern('golden')">✨ Golden Ratio</button>
                        <button class="pattern-btn" onclick="selectPattern('fractal')">🌿 Fractal Fern</button>
                        <button class="pattern-btn" onclick="selectPattern('mandala')">🔮 Sacred Mandala</button>
                        <button class="pattern-btn" onclick="selectPattern('voronoi')">🍃 Leaf Veins</button>
                        <button class="pattern-btn" onclick="selectPattern('crystal')">💎 Crystal Growth</button>
                        <button class="pattern-btn" onclick="selectPattern('wave')">🌊 Wave Patterns</button>
                        <button class="pattern-btn" onclick="selectPattern('tree')">🌳 Tree Branching</button>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>🎨 Style Gallery</h3>
                    <div class="gallery">
                        <div class="gallery-item" onclick="loadPreset('sunflower')">🌻 Sunflower</div>
                        <div class="gallery-item" onclick="loadPreset('nautilus')">🐚 Nautilus</div>
                        <div class="gallery-item" onclick="loadPreset('snowflake')">❄️ Snowflake</div>
                        <div class="gallery-item" onclick="loadPreset('galaxy')">🌌 Galaxy</div>
                        <div class="gallery-item" onclick="loadPreset('flower')">🌺 Flower</div>
                        <div class="gallery-item" onclick="loadPreset('crystal')">💎 Crystal</div>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>📚 Mathematical Info</h3>
                    <div class="info-panel">
                        <div class="info-title" id="patternTitle">Fibonacci Spiral</div>
                        <div class="info-text" id="patternInfo">
                            Found in sunflowers, pinecones, and galaxies. Each number is the sum of the two preceding ones: 1, 1, 2, 3, 5, 8, 13...
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="canvas-area">
                <canvas id="natureCanvas" class="canvas"></canvas>
                <div class="action-buttons" style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="generatePattern()">🎨 Generate Pattern</button>
                    <button class="btn btn-secondary" onclick="animatePattern()">✨ Animate Growth</button>
                    <button class="btn btn-secondary" onclick="exportArt()">💾 Export Creation</button>
                    <button class="btn btn-secondary" onclick="clearCanvas()">🗑️ Clear Canvas</button>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="panel">
                    <h3>⚙️ Pattern Controls</h3>
                    
                    <div class="control-group">
                        <label class="control-label">Complexity</label>
                        <input type="range" class="slider" id="complexity" min="3" max="20" value="8" oninput="updateValue('complexity')">
                        <div class="value-display" id="complexityValue">8</div>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Scale</label>
                        <input type="range" class="slider" id="scale" min="0.5" max="3" step="0.1" value="1" oninput="updateValue('scale')">
                        <div class="value-display" id="scaleValue">1.0</div>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Rotation</label>
                        <input type="range" class="slider" id="rotation" min="0" max="360" value="0" oninput="updateValue('rotation')">
                        <div class="value-display" id="rotationValue">0°</div>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Growth Speed</label>
                        <input type="range" class="slider" id="speed" min="1" max="10" value="5" oninput="updateValue('speed')">
                        <div class="value-display" id="speedValue">5</div>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>🎨 Colors</h3>
                    
                    <div class="control-group">
                        <label class="control-label">Primary Color</label>
                        <input type="color" class="color-picker" id="primaryColor" value="#4ade80" onchange="updateColors()">
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Secondary Color</label>
                        <input type="color" class="color-picker" id="secondaryColor" value="#22d3ee" onchange="updateColors()">
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Background</label>
                        <input type="color" class="color-picker" id="backgroundColor" value="#0f172a" onchange="updateColors()">
                    </div>
                </div>
                
                <div class="panel">
                    <h3>🔧 Advanced</h3>
                    
                    <div class="control-group">
                        <label class="control-label">Symmetry</label>
                        <input type="range" class="slider" id="symmetry" min="1" max="12" value="6" oninput="updateValue('symmetry')">
                        <div class="value-display" id="symmetryValue">6-fold</div>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Opacity</label>
                        <input type="range" class="slider" id="opacity" min="0.1" max="1" step="0.1" value="0.8" oninput="updateValue('opacity')">
                        <div class="value-display" id="opacityValue">0.8</div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="randomizeSettings()" style="margin-top: 10px;">🎲 Randomize</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let canvas, ctx;
        let currentPattern = 'fibonacci';
        let animationId;
        let isAnimating = false;
        
        // Pattern information database
        const patternInfo = {
            fibonacci: {
                title: "Fibonacci Spiral",
                description: "Found in sunflowers, pinecones, and galaxies. Each number is the sum of the two preceding ones: 1, 1, 2, 3, 5, 8, 13..."
            },
            golden: {
                title: "Golden Ratio",
                description: "The divine proportion (φ ≈ 1.618) appears in flower petals, tree branches, and human proportions. Nature's perfect balance."
            },
            fractal: {
                title: "Fractal Fern",
                description: "Self-similar patterns that repeat at every scale. Found in ferns, coastlines, and lightning. Infinite complexity from simple rules."
            },
            mandala: {
                title: "Sacred Mandala",
                description: "Circular patterns representing the cosmos. Based on radial symmetry found in flowers, crystals, and cellular structures."
            },
            voronoi: {
                title: "Voronoi Patterns",
                description: "Natural tessellations seen in leaf veins, giraffe spots, and cell structures. Optimal space division in nature."
            },
            crystal: {
                title: "Crystal Growth",
                description: "Geometric patterns formed by atomic arrangements. Creates the beautiful symmetries in snowflakes and minerals."
            },
            wave: {
                title: "Wave Interference",
                description: "Patterns created by overlapping waves. Seen in water ripples, sound waves, and quantum phenomena."
            },
            tree: {
                title: "Branching Patterns",
                description: "Recursive growth patterns in trees, blood vessels, and river deltas. Efficient distribution networks in nature."
            }
        };
        
        // Initialize the studio
        document.addEventListener('DOMContentLoaded', () => {
            canvas = document.getElementById('natureCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Generate initial pattern
            generatePattern();
            
            showNotification('🌿 Welcome to Savo Studio! Create beautiful mathematical art inspired by nature.');
        });
        
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
        }
        
        function selectPattern(pattern) {
            currentPattern = pattern;
            
            // Update UI
            document.querySelectorAll('.pattern-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update info panel
            const info = patternInfo[pattern];
            document.getElementById('patternTitle').textContent = info.title;
            document.getElementById('patternInfo').textContent = info.description;
            
            // Generate new pattern
            generatePattern();
            
            showNotification(`🎨 Switched to ${info.title}!`);
        }
        
        function generatePattern() {
            clearCanvas();
            
            const complexity = parseInt(document.getElementById('complexity').value);
            const scale = parseFloat(document.getElementById('scale').value);
            const rotation = parseInt(document.getElementById('rotation').value);
            const symmetry = parseInt(document.getElementById('symmetry').value);
            const opacity = parseFloat(document.getElementById('opacity').value);
            
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            const backgroundColor = document.getElementById('backgroundColor').value;
            
            // Set background
            ctx.fillStyle = backgroundColor;
            ctx.fillRect(0, 0, canvas.width / window.devicePixelRatio, canvas.height / window.devicePixelRatio);
            
            ctx.save();
            ctx.translate(canvas.width / (2 * window.devicePixelRatio), canvas.height / (2 * window.devicePixelRatio));
            ctx.rotate(rotation * Math.PI / 180);
            ctx.globalAlpha = opacity;
            
            switch(currentPattern) {
                case 'fibonacci':
                    drawFibonacciSpiral(complexity, scale, primaryColor, secondaryColor);
                    break;
                case 'golden':
                    drawGoldenRatio(complexity, scale, primaryColor, secondaryColor);
                    break;
                case 'fractal':
                    drawFractalFern(complexity, scale, primaryColor);
                    break;
                case 'mandala':
                    drawMandala(complexity, scale, symmetry, primaryColor, secondaryColor);
                    break;
                case 'voronoi':
                    drawVoronoi(complexity, scale, primaryColor, secondaryColor);
                    break;
                case 'crystal':
                    drawCrystal(complexity, scale, symmetry, primaryColor, secondaryColor);
                    break;
                case 'wave':
                    drawWavePattern(complexity, scale, primaryColor, secondaryColor);
                    break;
                case 'tree':
                    drawTreeBranching(complexity, scale, primaryColor);
                    break;
            }
            
            ctx.restore();
        }
        
        function drawFibonacciSpiral(complexity, scale, color1, color2) {
            const phi = (1 + Math.sqrt(5)) / 2;
            let a = 1, b = 1;
            
            ctx.strokeStyle = color1;
            ctx.lineWidth = 2 * scale;
            
            for (let i = 0; i < complexity; i++) {
                const radius = b * scale * 10;
                const startAngle = i * Math.PI / 2;
                
                // Create gradient
                const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, radius);
                gradient.addColorStop(0, color1);
                gradient.addColorStop(1, color2);
                ctx.strokeStyle = gradient;
                
                ctx.beginPath();
                ctx.arc(0, 0, radius, startAngle, startAngle + Math.PI / 2);
                ctx.stroke();
                
                // Draw connecting lines
                ctx.beginPath();
                ctx.moveTo(radius * Math.cos(startAngle), radius * Math.sin(startAngle));
                ctx.lineTo(radius * Math.cos(startAngle + Math.PI / 2), radius * Math.sin(startAngle + Math.PI / 2));
                ctx.stroke();
                
                [a, b] = [b, a + b];
            }
        }
        
        function drawGoldenRatio(complexity, scale, color1, color2) {
            const phi = (1 + Math.sqrt(5)) / 2;
            
            for (let i = 0; i < complexity; i++) {
                const size = Math.pow(phi, i) * scale * 5;
                const hue = (i * 360 / complexity) % 360;
                
                ctx.strokeStyle = `hsl(${hue}, 70%, 60%)`;
                ctx.lineWidth = 2;
                ctx.strokeRect(-size/2, -size/2, size, size);
                
                // Draw golden spiral
                ctx.beginPath();
                ctx.arc(0, 0, size * 0.618, 0, Math.PI * 2);
                ctx.stroke();
            }
        }
        
        function drawFractalFern(complexity, scale, color) {
            const points = [];
            let x = 0, y = 0;
            
            // Generate fern points using IFS
            for (let i = 0; i < complexity * 1000; i++) {
                const r = Math.random();
                let newX, newY;
                
                if (r < 0.01) {
                    newX = 0;
                    newY = 0.16 * y;
                } else if (r < 0.86) {
                    newX = 0.85 * x + 0.04 * y;
                    newY = -0.04 * x + 0.85 * y + 1.6;
                } else if (r < 0.93) {
                    newX = 0.2 * x - 0.26 * y;
                    newY = 0.23 * x + 0.22 * y + 1.6;
                } else {
                    newX = -0.15 * x + 0.28 * y;
                    newY = 0.26 * x + 0.24 * y + 0.44;
                }
                
                x = newX;
                y = newY;
                
                if (i > 100) { // Skip first few iterations
                    points.push({x: x * scale * 30, y: -y * scale * 30});
                }
            }
            
            // Draw fern
            ctx.fillStyle = color;
            points.forEach(point => {
                ctx.fillRect(point.x, point.y, 1, 1);
            });
        }
        
        function drawMandala(complexity, scale, symmetry, color1, color2) {
            for (let layer = 0; layer < complexity; layer++) {
                const radius = (layer + 1) * scale * 15;
                
                for (let i = 0; i < symmetry; i++) {
                    const angle = (i * 2 * Math.PI) / symmetry;
                    
                    ctx.save();
                    ctx.rotate(angle);
                    
                    // Draw petal shape
                    const gradient = ctx.createLinearGradient(0, 0, radius, 0);
                    gradient.addColorStop(0, color1);
                    gradient.addColorStop(1, color2);
                    ctx.fillStyle = gradient;
                    
                    ctx.beginPath();
                    ctx.ellipse(radius/2, 0, radius/4, radius/8, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.restore();
                }
            }
        }
        
        function drawVoronoi(complexity, scale, color1, color2) {
            const points = [];
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;
            
            // Generate random seed points
            for (let i = 0; i < complexity; i++) {
                points.push({
                    x: (Math.random() - 0.5) * width * scale,
                    y: (Math.random() - 0.5) * height * scale
                });
            }
            
            // Draw Voronoi cells
            const imageData = ctx.createImageData(width, height);
            
            for (let x = 0; x < width; x++) {
                for (let y = 0; y < height; y++) {
                    let minDist = Infinity;
                    let closestPoint = 0;
                    
                    points.forEach((point, index) => {
                        const dist = Math.sqrt((x - width/2 - point.x)**2 + (y - height/2 - point.y)**2);
                        if (dist < minDist) {
                            minDist = dist;
                            closestPoint = index;
                        }
                    });
                    
                    const hue = (closestPoint * 360 / points.length) % 360;
                    const rgb = hslToRgb(hue / 360, 0.7, 0.6);
                    
                    const index = (y * width + x) * 4;
                    imageData.data[index] = rgb[0];
                    imageData.data[index + 1] = rgb[1];
                    imageData.data[index + 2] = rgb[2];
                    imageData.data[index + 3] = 255;
                }
            }
            
            ctx.putImageData(imageData, 260, 360);
        }
        
        function drawCrystal(complexity, scale, symmetry, color1, color2) {
            for (let layer = 0; layer < complexity; layer++) {
                const radius = (layer + 1) * scale * 20;
                
                ctx.strokeStyle = layer % 2 === 0 ? color1 : color2;
                ctx.lineWidth = 2;
                
                ctx.beginPath();
                for (let i = 0; i <= symmetry; i++) {
                    const angle = (i * 2 * Math.PI) / symmetry;
                    const x = radius * Math.cos(angle);
                    const y = radius * Math.sin(angle);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.stroke();
            }
        }
        
        function drawWavePattern(complexity, scale, color1, color2) {
            const width = canvas.width / window.devicePixelRatio;
            const height = canvas.height / window.devicePixelRatio;
            
            for (let i = 0; i < complexity; i++) {
                const frequency = (i + 1) * 0.02 * scale;
                const amplitude = 50 * scale;
                
                const gradient = ctx.createLinearGradient(-width/2, 0, width/2, 0);
                gradient.addColorStop(0, color1);
                gradient.addColorStop(1, color2);
                ctx.strokeStyle = gradient;
                ctx.lineWidth = 2;
                
                ctx.beginPath();
                for (let x = -width/2; x < width/2; x += 2) {
                    const y = amplitude * Math.sin(x * frequency + i * Math.PI / 4);
                    if (x === -width/2) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            }
        }
        
        function drawTreeBranching(complexity, scale, color) {
            ctx.strokeStyle = color;
            ctx.lineWidth = complexity * scale;
            
            function drawBranch(x, y, angle, length, depth) {
                if (depth === 0) return;
                
                const endX = x + length * Math.cos(angle);
                const endY = y + length * Math.sin(angle);
                
                ctx.lineWidth = depth * scale;
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(endX, endY);
                ctx.stroke();
                
                const newLength = length * 0.7;
                drawBranch(endX, endY, angle - Math.PI/6, newLength, depth - 1);
                drawBranch(endX, endY, angle + Math.PI/6, newLength, depth - 1);
            }
            
            drawBranch(0, 100 * scale, -Math.PI/2, 80 * scale, complexity);
        }
        
        function animatePattern() {
            if (isAnimating) {
                cancelAnimationFrame(animationId);
                isAnimating = false;
                event.target.textContent = '✨ Animate Growth';
                return;
            }
            
            isAnimating = true;
            event.target.textContent = '⏹️ Stop Animation';
            
            let frame = 0;
            const speed = parseInt(document.getElementById('speed').value);
            
            function animate() {
                if (!isAnimating) return;
                
                frame += speed;
                
                // Animate rotation
                document.getElementById('rotation').value = (frame * 2) % 360;
                updateValue('rotation');
                
                // Animate complexity
                const baseComplexity = parseInt(document.getElementById('complexity').value);
                const animatedComplexity = Math.max(1, Math.floor(baseComplexity * (Math.sin(frame * 0.05) + 1) / 2));
                
                generatePattern();
                
                animationId = requestAnimationFrame(animate);
            }
            
            animate();
        }
        
        function loadPreset(preset) {
            const presets = {
                sunflower: {
                    pattern: 'fibonacci',
                    complexity: 12,
                    scale: 1.2,
                    primaryColor: '#fbbf24',
                    secondaryColor: '#f59e0b',
                    backgroundColor: '#0f172a'
                },
                nautilus: {
                    pattern: 'golden',
                    complexity: 8,
                    scale: 1.5,
                    primaryColor: '#ec4899',
                    secondaryColor: '#be185d',
                    backgroundColor: '#1e293b'
                },
                snowflake: {
                    pattern: 'crystal',
                    complexity: 6,
                    scale: 1.0,
                    symmetry: 6,
                    primaryColor: '#22d3ee',
                    secondaryColor: '#0891b2',
                    backgroundColor: '#0f172a'
                },
                galaxy: {
                    pattern: 'fibonacci',
                    complexity: 15,
                    scale: 2.0,
                    primaryColor: '#a78bfa',
                    secondaryColor: '#7c3aed',
                    backgroundColor: '#0c0a09'
                },
                flower: {
                    pattern: 'mandala',
                    complexity: 8,
                    scale: 1.3,
                    symmetry: 8,
                    primaryColor: '#fb7185',
                    secondaryColor: '#e11d48',
                    backgroundColor: '#14532d'
                },
                crystal: {
                    pattern: 'crystal',
                    complexity: 10,
                    scale: 1.1,
                    symmetry: 12,
                    primaryColor: '#4ade80',
                    secondaryColor: '#16a34a',
                    backgroundColor: '#1e1b4b'
                }
            };
            
            const config = presets[preset];
            if (!config) return;
            
            // Apply preset settings
            selectPattern(config.pattern);
            document.getElementById('complexity').value = config.complexity;
            document.getElementById('scale').value = config.scale;
            document.getElementById('primaryColor').value = config.primaryColor;
            document.getElementById('secondaryColor').value = config.secondaryColor;
            document.getElementById('backgroundColor').value = config.backgroundColor;
            
            if (config.symmetry) {
                document.getElementById('symmetry').value = config.symmetry;
            }
            
            // Update displays
            updateAllValues();
            generatePattern();
            
            showNotification(`🎨 Loaded ${preset} preset!`);
        }
        
        function updateValue(controlId) {
            const control = document.getElementById(controlId);
            const display = document.getElementById(controlId + 'Value');
            
            let value = control.value;
            if (controlId === 'rotation') value += '°';
            if (controlId === 'symmetry') value += '-fold';
            
            display.textContent = value;
            
            // Auto-regenerate pattern
            if (!isAnimating) {
                generatePattern();
            }
        }
        
        function updateAllValues() {
            ['complexity', 'scale', 'rotation', 'speed', 'symmetry', 'opacity'].forEach(updateValue);
        }
        
        function updateColors() {
            if (!isAnimating) {
                generatePattern();
            }
        }
        
        function randomizeSettings() {
            document.getElementById('complexity').value = Math.floor(Math.random() * 15) + 5;
            document.getElementById('scale').value = (Math.random() * 2 + 0.5).toFixed(1);
            document.getElementById('rotation').value = Math.floor(Math.random() * 360);
            document.getElementById('symmetry').value = Math.floor(Math.random() * 10) + 3;
            document.getElementById('opacity').value = (Math.random() * 0.5 + 0.5).toFixed(1);
            
            // Random colors
            document.getElementById('primaryColor').value = getRandomColor();
            document.getElementById('secondaryColor').value = getRandomColor();
            document.getElementById('backgroundColor').value = getRandomDarkColor();
            
            updateAllValues();
            generatePattern();
            
            showNotification('🎲 Settings randomized! Discover new patterns!');
        }
        
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width / window.devicePixelRatio, canvas.height / window.devicePixelRatio);
        }
        
        function exportArt() {
            const link = document.createElement('a');
            link.download = `savo-studio-${currentPattern}-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            showNotification('💾 Artwork exported successfully!');
        }
        
        // Utility functions
        function getRandomColor() {
            const colors = ['#4ade80', '#22d3ee', '#a78bfa', '#fb7185', '#fbbf24', '#f97316'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        function getRandomDarkColor() {
            const colors = ['#0f172a', '#1e293b', '#14532d', '#1e1b4b', '#0c0a09'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        function hslToRgb(h, s, l) {
            let r, g, b;
            
            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            
            return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 30px;
                right: 30px;
                background: rgba(74, 222, 128, 0.95);
                color: #0f172a;
                padding: 15px 25px;
                border-radius: 12px;
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.4s ease;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255,255,255,0.3);
                max-width: 300px;
                font-size: 0.9rem;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.4s ease forwards';
                setTimeout(() => notification.remove(), 400);
            }, 4000);
        }
        
        // Add CSS for notification animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9711c5f3b31fa0a1',t:'MTc1NTUyMzkwNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
